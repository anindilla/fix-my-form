FROM python:3.11-slim

# Install system dependencies for MediaPipe and OpenCV
RUN apt-get update && apt-get install -y \
    libgl1-mesa-glx \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1 \
    libgstreamer1.0-0 \
    libgstreamer-plugins-base1.0-0 \
    libgstreamer-plugins-good1.0-0 \
    libgstreamer-plugins-bad1.0-0 \
    libgstreamer-plugins-ugly1.0-0 \
    libgstreamer1.0-dev \
    libgstreamer-plugins-base1.0-dev \
    libgstreamer-plugins-good1.0-dev \
    libgstreamer-plugins-bad1.0-dev \
    libgstreamer-plugins-ugly1.0-dev \
    libgstreamer1.0-tools \
    libgstreamer-plugins-base1.0-tools \
    libgstreamer-plugins-good1.0-tools \
    libgstreamer-plugins-bad1.0-tools \
    libgstreamer-plugins-ugly1.0-tools \
    libgstreamer1.0-common \
    libgstreamer-plugins-base1.0-common \
    libgstreamer-plugins-good1.0-common \
    libgstreamer-plugins-bad1.0-common \
    libgstreamer-plugins-ugly1.0-common \
    libgstreamer1.0-doc \
    libgstreamer-plugins-base1.0-doc \
    libgstreamer-plugins-good1.0-doc \
    libgstreamer-plugins-bad1.0-doc \
    libgstreamer-plugins-ugly1.0-doc \
    libgstreamer1.0-utils \
    libgstreamer-plugins-base1.0-utils \
    libgstreamer-plugins-good1.0-utils \
    libgstreamer-plugins-bad1.0-utils \
    libgstreamer-plugins-ugly1.0-utils \
    libgstreamer1.0-alsa \
    libgstreamer-plugins-base1.0-alsa \
    libgstreamer-plugins-good1.0-alsa \
    libgstreamer-plugins-bad1.0-alsa \
    libgstreamer-plugins-ugly1.0-alsa \
    libgstreamer1.0-pulseaudio \
    libgstreamer-plugins-base1.0-pulseaudio \
    libgstreamer-plugins-good1.0-pulseaudio \
    libgstreamer-plugins-bad1.0-pulseaudio \
    libgstreamer-plugins-ugly1.0-pulseaudio \
    libgstreamer1.0-x11 \
    libgstreamer-plugins-base1.0-x11 \
    libgstreamer-plugins-good1.0-x11 \
    libgstreamer-plugins-bad1.0-x11 \
    libgstreamer-plugins-ugly1.0-x11 \
    libgstreamer1.0-wayland \
    libgstreamer-plugins-base1.0-wayland \
    libgstreamer-plugins-good1.0-wayland \
    libgstreamer-plugins-bad1.0-wayland \
    libgstreamer-plugins-ugly1.0-wayland \
    libgstreamer1.0-vulkan \
    libgstreamer-plugins-base1.0-vulkan \
    libgstreamer-plugins-good1.0-vulkan \
    libgstreamer-plugins-bad1.0-vulkan \
    libgstreamer-plugins-ugly1.0-vulkan \
    libgstreamer1.0-opengl \
    libgstreamer-plugins-base1.0-opengl \
    libgstreamer-plugins-good1.0-opengl \
    libgstreamer-plugins-bad1.0-opengl \
    libgstreamer-plugins-ugly1.0-opengl \
    libgstreamer1.0-egl \
    libgstreamer-plugins-base1.0-egl \
    libgstreamer-plugins-good1.0-egl \
    libgstreamer-plugins-bad1.0-egl \
    libgstreamer-plugins-ugly1.0-egl \
    libgstreamer1.0-gles2 \
    libgstreamer-plugins-base1.0-gles2 \
    libgstreamer-plugins-good1.0-gles2 \
    libgstreamer-plugins-bad1.0-gles2 \
    libgstreamer-plugins-ugly1.0-gles2 \
    libgstreamer1.0-gles3 \
    libgstreamer-plugins-base1.0-gles3 \
    libgstreamer-plugins-good1.0-gles3 \
    libgstreamer-plugins-bad1.0-gles3 \
    libgstreamer-plugins-ugly1.0-gles3 \
    libgstreamer1.0-gles31 \
    libgstreamer-plugins-base1.0-gles31 \
    libgstreamer-plugins-good1.0-gles31 \
    libgstreamer-plugins-bad1.0-gles31 \
    libgstreamer-plugins-ugly1.0-gles31 \
    libgstreamer1.0-gles32 \
    libgstreamer-plugins-base1.0-gles32 \
    libgstreamer-plugins-good1.0-gles32 \
    libgstreamer-plugins-bad1.0-gles32 \
    libgstreamer-plugins-ugly1.0-gles32 \
    libgstreamer1.0-gles33 \
    libgstreamer-plugins-base1.0-gles33 \
    libgstreamer-plugins-good1.0-gles33 \
    libgstreamer-plugins-bad1.0-gles33 \
    libgstreamer-plugins-ugly1.0-gles33 \
    libgstreamer1.0-gles34 \
    libgstreamer-plugins-base1.0-gles34 \
    libgstreamer-plugins-good1.0-gles34 \
    libgstreamer-plugins-bad1.0-gles34 \
    libgstreamer-plugins-ugly1.0-gles34 \
    libgstreamer1.0-gles35 \
    libgstreamer-plugins-base1.0-gles35 \
    libgstreamer-plugins-good1.0-gles35 \
    libgstreamer-plugins-bad1.0-gles35 \
    libgstreamer-plugins-ugly1.0-gles35 \
    libgstreamer1.0-gles36 \
    libgstreamer-plugins-base1.0-gles36 \
    libgstreamer-plugins-good1.0-gles36 \
    libgstreamer-plugins-bad1.0-gles36 \
    libgstreamer-plugins-ugly1.0-gles36 \
    libgstreamer1.0-gles37 \
    libgstreamer-plugins-base1.0-gles37 \
    libgstreamer-plugins-good1.0-gles37 \
    libgstreamer-plugins-bad1.0-gles37 \
    libgstreamer-plugins-ugly1.0-gles37 \
    libgstreamer1.0-gles38 \
    libgstreamer-plugins-base1.0-gles38 \
    libgstreamer-plugins-good1.0-gles38 \
    libgstreamer-plugins-bad1.0-gles38 \
    libgstreamer-plugins-ugly1.0-gles38 \
    libgstreamer1.0-gles39 \
    libgstreamer-plugins-base1.0-gles39 \
    libgstreamer-plugins-good1.0-gles39 \
    libgstreamer-plugins-bad1.0-gles39 \
    libgstreamer-plugins-ugly1.0-gles39 \
    libgstreamer1.0-gles40 \
    libgstreamer-plugins-base1.0-gles40 \
    libgstreamer-plugins-good1.0-gles40 \
    libgstreamer-plugins-bad1.0-gles40 \
    libgstreamer-plugins-ugly1.0-gles40 \
    libgstreamer1.0-gles41 \
    libgstreamer-plugins-base1.0-gles41 \
    libgstreamer-plugins-good1.0-gles41 \
    libgstreamer-plugins-bad1.0-gles41 \
    libgstreamer-plugins-ugly1.0-gles41 \
    libgstreamer1.0-gles42 \
    libgstreamer-plugins-base1.0-gles42 \
    libgstreamer-plugins-good1.0-gles42 \
    libgstreamer-plugins-bad1.0-gles42 \
    libgstreamer-plugins-ugly1.0-gles42 \
    libgstreamer1.0-gles43 \
    libgstreamer-plugins-base1.0-gles43 \
    libgstreamer-plugins-good1.0-gles43 \
    libgstreamer-plugins-bad1.0-gles43 \
    libgstreamer-plugins-ugly1.0-gles43 \
    libgstreamer1.0-gles44 \
    libgstreamer-plugins-base1.0-gles44 \
    libgstreamer-plugins-good1.0-gles44 \
    libgstreamer-plugins-bad1.0-gles44 \
    libgstreamer-plugins-ugly1.0-gles44 \
    libgstreamer1.0-gles45 \
    libgstreamer-plugins-base1.0-gles45 \
    libgstreamer-plugins-good1.0-gles45 \
    libgstreamer-plugins-bad1.0-gles45 \
    libgstreamer-plugins-ugly1.0-gles45 \
    libgstreamer1.0-gles46 \
    libgstreamer-plugins-base1.0-gles46 \
    libgstreamer-plugins-good1.0-gles46 \
    libgstreamer-plugins-bad1.0-gles46 \
    libgstreamer-plugins-ugly1.0-gles46 \
    libgstreamer1.0-gles47 \
    libgstreamer-plugins-base1.0-gles47 \
    libgstreamer-plugins-good1.0-gles47 \
    libgstreamer-plugins-bad1.0-gles47 \
    libgstreamer-plugins-ugly1.0-gles47 \
    libgstreamer1.0-gles48 \
    libgstreamer-plugins-base1.0-gles48 \
    libgstreamer-plugins-good1.0-gles48 \
    libgstreamer-plugins-bad1.0-gles48 \
    libgstreamer-plugins-ugly1.0-gles48 \
    libgstreamer1.0-gles49 \
    libgstreamer-plugins-base1.0-gles49 \
    libgstreamer-plugins-good1.0-gles49 \
    libgstreamer-plugins-bad1.0-gles49 \
    libgstreamer-plugins-ugly1.0-gles49 \
    libgstreamer1.0-gles50 \
    libgstreamer-plugins-base1.0-gles50 \
    libgstreamer-plugins-good1.0-gles50 \
    libgstreamer-plugins-bad1.0-gles50 \
    libgstreamer-plugins-ugly1.0-gles50 \
    libgstreamer1.0-gles51 \
    libgstreamer-plugins-base1.0-gles51 \
    libgstreamer-plugins-good1.0-gles51 \
    libgstreamer-plugins-bad1.0-gles51 \
    libgstreamer-plugins-ugly1.0-gles51 \
    libgstreamer1.0-gles52 \
    libgstreamer-plugins-base1.0-gles52 \
    libgstreamer-plugins-good1.0-gles52 \
    libgstreamer-plugins-bad1.0-gles52 \
    libgstreamer-plugins-ugly1.0-gles52 \
    libgstreamer1.0-gles53 \
    libgstreamer-plugins-base1.0-gles53 \
    libgstreamer-plugins-good1.0-gles53 \
    libgstreamer-plugins-bad1.0-gles53 \
    libgstreamer-plugins-ugly1.0-gles53 \
    libgstreamer1.0-gles54 \
    libgstreamer-plugins-base1.0-gles54 \
    libgstreamer-plugins-good1.0-gles54 \
    libgstreamer-plugins-bad1.0-gles54 \
    libgstreamer-plugins-ugly1.0-gles54 \
    libgstreamer1.0-gles55 \
    libgstreamer-plugins-base1.0-gles55 \
    libgstreamer-plugins-good1.0-gles55 \
    libgstreamer-plugins-bad1.0-gles55 \
    libgstreamer-plugins-ugly1.0-gles55 \
    libgstreamer1.0-gles56 \
    libgstreamer-plugins-base1.0-gles56 \
    libgstreamer-plugins-good1.0-gles56 \
    libgstreamer-plugins-bad1.0-gles56 \
    libgstreamer-plugins-ugly1.0-gles56 \
    libgstreamer1.0-gles57 \
    libgstreamer-plugins-base1.0-gles57 \
    libgstreamer-plugins-good1.0-gles57 \
    libgstreamer-plugins-bad1.0-gles57 \
    libgstreamer-plugins-ugly1.0-gles57 \
    libgstreamer1.0-gles58 \
    libgstreamer-plugins-base1.0-gles58 \
    libgstreamer-plugins-good1.0-gles58 \
    libgstreamer-plugins-bad1.0-gles58 \
    libgstreamer-plugins-ugly1.0-gles58 \
    libgstreamer1.0-gles59 \
    libgstreamer-plugins-base1.0-gles59 \
    libgstreamer-plugins-good1.0-gles59 \
    libgstreamer-plugins-bad1.0-gles59 \
    libgstreamer-plugins-ugly1.0-gles59 \
    libgstreamer1.0-gles60 \
    libgstreamer-plugins-base1.0-gles60 \
    libgstreamer-plugins-good1.0-gles60 \
    libgstreamer-plugins-bad1.0-gles60 \
    libgstreamer-plugins-ugly1.0-gles60 \
    libgstreamer1.0-gles61 \
    libgstreamer-plugins-base1.0-gles61 \
    libgstreamer-plugins-good1.0-gles61 \
    libgstreamer-plugins-bad1.0-gles61 \
    libgstreamer-plugins-ugly1.0-gles61 \
    libgstreamer1.0-gles62 \
    libgstreamer-plugins-base1.0-gles62 \
    libgstreamer-plugins-good1.0-gles62 \
    libgstreamer-plugins-bad1.0-gles62 \
    libgstreamer-plugins-ugly1.0-gles62 \
    libgstreamer1.0-gles63 \
    libgstreamer-plugins-base1.0-gles63 \
    libgstreamer-plugins-good1.0-gles63 \
    libgstreamer-plugins-bad1.0-gles63 \
    libgstreamer-plugins-ugly1.0-gles63 \
    libgstreamer1.0-gles64 \
    libgstreamer-plugins-base1.0-gles64 \
    libgstreamer-plugins-good1.0-gles64 \
    libgstreamer-plugins-bad1.0-gles64 \
    libgstreamer-plugins-ugly1.0-gles64 \
    libgstreamer1.0-gles65 \
    libgstreamer-plugins-base1.0-gles65 \
    libgstreamer-plugins-good1.0-gles65 \
    libgstreamer-plugins-bad1.0-gles65 \
    libgstreamer-plugins-ugly1.0-gles65 \
    libgstreamer1.0-gles66 \
    libgstreamer-plugins-base1.0-gles66 \
    libgstreamer-plugins-good1.0-gles66 \
    libgstreamer-plugins-bad1.0-gles66 \
    libgstreamer-plugins-ugly1.0-gles66 \
    libgstreamer1.0-gles67 \
    libgstreamer-plugins-base1.0-gles67 \
    libgstreamer-plugins-good1.0-gles67 \
    libgstreamer-plugins-bad1.0-gles67 \
    libgstreamer-plugins-ugly1.0-gles67 \
    libgstreamer1.0-gles68 \
    libgstreamer-plugins-base1.0-gles68 \
    libgstreamer-plugins-good1.0-gles68 \
    libgstreamer-plugins-bad1.0-gles68 \
    libgstreamer-plugins-ugly1.0-gles68 \
    libgstreamer1.0-gles69 \
    libgstreamer-plugins-base1.0-gles69 \
    libgstreamer-plugins-good1.0-gles69 \
    libgstreamer-plugins-bad1.0-gles69 \
    libgstreamer-plugins-ugly1.0-gles69 \
    libgstreamer1.0-gles70 \
    libgstreamer-plugins-base1.0-gles70 \
    libgstreamer-plugins-good1.0-gles70 \
    libgstreamer-plugins-bad1.0-gles70 \
    libgstreamer-plugins-ugly1.0-gles70 \
    libgstreamer1.0-gles71 \
    libgstreamer-plugins-base1.0-gles71 \
    libgstreamer-plugins-good1.0-gles71 \
    libgstreamer-plugins-bad1.0-gles71 \
    libgstreamer-plugins-ugly1.0-gles71 \
    libgstreamer1.0-gles72 \
    libgstreamer-plugins-base1.0-gles72 \
    libgstreamer-plugins-good1.0-gles72 \
    libgstreamer-plugins-bad1.0-gles72 \
    libgstreamer-plugins-ugly1.0-gles72 \
    libgstreamer1.0-gles73 \
    libgstreamer-plugins-base1.0-gles73 \
    libgstreamer-plugins-good1.0-gles73 \
    libgstreamer-plugins-bad1.0-gles73 \
    libgstreamer-plugins-ugly1.0-gles73 \
    libgstreamer1.0-gles74 \
    libgstreamer-plugins-base1.0-gles74 \
    libgstreamer-plugins-good1.0-gles74 \
    libgstreamer-plugins-bad1.0-gles74 \
    libgstreamer-plugins-ugly1.0-gles74 \
    libgstreamer1.0-gles75 \
    libgstreamer-plugins-base1.0-gles75 \
    libgstreamer-plugins-good1.0-gles75 \
    libgstreamer-plugins-bad1.0-gles75 \
    libgstreamer-plugins-ugly1.0-gles75 \
    libgstreamer1.0-gles76 \
    libgstreamer-plugins-base1.0-gles76 \
    libgstreamer-plugins-good1.0-gles76 \
    libgstreamer-plugins-bad1.0-gles76 \
    libgstreamer-plugins-ugly1.0-gles76 \
    libgstreamer1.0-gles77 \
    libgstreamer-plugins-base1.0-gles77 \
    libgstreamer-plugins-good1.0-gles77 \
    libgstreamer-plugins-bad1.0-gles77 \
    libgstreamer-plugins-ugly1.0-gles77 \
    libgstreamer1.0-gles78 \
    libgstreamer-plugins-base1.0-gles78 \
    libgstreamer-plugins-good1.0-gles78 \
    libgstreamer-plugins-bad1.0-gles78 \
    libgstreamer-plugins-ugly1.0-gles78 \
    libgstreamer1.0-gles79 \
    libgstreamer-plugins-base1.0-gles79 \
    libgstreamer-plugins-good1.0-gles79 \
    libgstreamer-plugins-bad1.0-gles79 \
    libgstreamer-plugins-ugly1.0-gles79 \
    libgstreamer1.0-gles80 \
    libgstreamer-plugins-base1.0-gles80 \
    libgstreamer-plugins-good1.0-gles80 \
    libgstreamer-plugins-bad1.0-gles80 \
    libgstreamer-plugins-ugly1.0-gles80 \
    libgstreamer1.0-gles81 \
    libgstreamer-plugins-base1.0-gles81 \
    libgstreamer-plugins-good1.0-gles81 \
    libgstreamer-plugins-bad1.0-gles81 \
    libgstreamer-plugins-ugly1.0-gles81 \
    libgstreamer1.0-gles82 \
    libgstreamer-plugins-base1.0-gles82 \
    libgstreamer-plugins-good1.0-gles82 \
    libgstreamer-plugins-bad1.0-gles82 \
    libgstreamer-plugins-ugly1.0-gles82 \
    libgstreamer1.0-gles83 \
    libgstreamer-plugins-base1.0-gles83 \
    libgstreamer-plugins-good1.0-gles83 \
    libgstreamer-plugins-bad1.0-gles83 \
    libgstreamer-plugins-ugly1.0-gles83 \
    libgstreamer1.0-gles84 \
    libgstreamer-plugins-base1.0-gles84 \
    libgstreamer-plugins-good1.0-gles84 \
    libgstreamer-plugins-bad1.0-gles84 \
    libgstreamer-plugins-ugly1.0-gles84 \
    libgstreamer1.0-gles85 \
    libgstreamer-plugins-base1.0-gles85 \
    libgstreamer-plugins-good1.0-gles85 \
    libgstreamer-plugins-bad1.0-gles85 \
    libgstreamer-plugins-ugly1.0-gles85 \
    libgstreamer1.0-gles86 \
    libgstreamer-plugins-base1.0-gles86 \
    libgstreamer-plugins-good1.0-gles86 \
    libgstreamer-plugins-bad1.0-gles86 \
    libgstreamer-plugins-ugly1.0-gles86 \
    libgstreamer1.0-gles87 \
    libgstreamer-plugins-base1.0-gles87 \
    libgstreamer-plugins-good1.0-gles87 \
    libgstreamer-plugins-bad1.0-gles87 \
    libgstreamer-plugins-ugly1.0-gles87 \
    libgstreamer1.0-gles88 \
    libgstreamer-plugins-base1.0-gles88 \
    libgstreamer-plugins-good1.0-gles88 \
    libgstreamer-plugins-bad1.0-gles88 \
    libgstreamer-plugins-ugly1.0-gles88 \
    libgstreamer1.0-gles89 \
    libgstreamer-plugins-base1.0-gles89 \
    libgstreamer-plugins-good1.0-gles89 \
    libgstreamer-plugins-bad1.0-gles89 \
    libgstreamer-plugins-ugly1.0-gles89 \
    libgstreamer1.0-gles90 \
    libgstreamer-plugins-base1.0-gles90 \
    libgstreamer-plugins-good1.0-gles90 \
    libgstreamer-plugins-bad1.0-gles90 \
    libgstreamer-plugins-ugly1.0-gles90 \
    libgstreamer1.0-gles91 \
    libgstreamer-plugins-base1.0-gles91 \
    libgstreamer-plugins-good1.0-gles91 \
    libgstreamer-plugins-bad1.0-gles91 \
    libgstreamer-plugins-ugly1.0-gles91 \
    libgstreamer1.0-gles92 \
    libgstreamer-plugins-base1.0-gles92 \
    libgstreamer-plugins-good1.0-gles92 \
    libgstreamer-plugins-bad1.0-gles92 \
    libgstreamer-plugins-ugly1.0-gles92 \
    libgstreamer1.0-gles93 \
    libgstreamer-plugins-base1.0-gles93 \
    libgstreamer-plugins-good1.0-gles93 \
    libgstreamer-plugins-bad1.0-gles93 \
    libgstreamer-plugins-ugly1.0-gles93 \
    libgstreamer1.0-gles94 \
    libgstreamer-plugins-base1.0-gles94 \
    libgstreamer-plugins-good1.0-gles94 \
    libgstreamer-plugins-bad1.0-gles94 \
    libgstreamer-plugins-ugly1.0-gles94 \
    libgstreamer1.0-gles95 \
    libgstreamer-plugins-base1.0-gles95 \
    libgstreamer-plugins-good1.0-gles95 \
    libgstreamer-plugins-bad1.0-gles95 \
    libgstreamer-plugins-ugly1.0-gles95 \
    libgstreamer1.0-gles96 \
    libgstreamer-plugins-base1.0-gles96 \
    libgstreamer-plugins-good1.0-gles96 \
    libgstreamer-plugins-bad1.0-gles96 \
    libgstreamer-plugins-ugly1.0-gles96 \
    libgstreamer1.0-gles97 \
    libgstreamer-plugins-base1.0-gles97 \
    libgstreamer-plugins-good1.0-gles97 \
    libgstreamer-plugins-bad1.0-gles97 \
    libgstreamer-plugins-ugly1.0-gles97 \
    libgstreamer1.0-gles98 \
    libgstreamer-plugins-base1.0-gles98 \
    libgstreamer-plugins-good1.0-gles98 \
    libgstreamer-plugins-bad1.0-gles98 \
    libgstreamer-plugins-ugly1.0-gles98 \
    libgstreamer1.0-gles99 \
    libgstreamer-plugins-base1.0-gles99 \
    libgstreamer-plugins-good1.0-gles99 \
    libgstreamer-plugins-bad1.0-gles99 \
    libgstreamer-plugins-ugly1.0-gles99 \
    libgstreamer1.0-gles100 \
    libgstreamer-plugins-base1.0-gles100 \
    libgstreamer-plugins-good1.0-gles100 \
    libgstreamer-plugins-bad1.0-gles100 \
    libgstreamer-plugins-ugly1.0-gles100 \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy requirements and install Python dependencies
COPY requirements.txt .

# Install MediaPipe first with specific flags
RUN pip install --no-cache-dir mediapipe==0.10.3 --no-deps || pip install --no-cache-dir mediapipe==0.10.0 --no-deps || pip install --no-cache-dir mediapipe

# Install other dependencies
RUN pip install --no-cache-dir -r requirements.txt

# Copy application code
COPY . .

# Expose port
EXPOSE 8000

# Run the application
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
